<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>এডমিন প্যানেল</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #d82028; --secondary-color: #222222; }
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .login-container, .admin-panel { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: var(--secondary-color); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; font-family: 'Hind Siliguri', sans-serif; }
        button { width: 100%; padding: 12px; background-color: var(--primary-color); color: #fff; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #b01820; }
        #admin-panel { display: none; } /* Initially hidden */
        .posts-list .post-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .posts-list .post-item:last-child { border-bottom: none; }
        .post-item-actions button { width: auto; padding: 5px 10px; font-size: 14px; margin-left: 5px; }
        .btn-edit { background-color: #28a745; }
        .btn-delete { background-color: #dc3545; }
        #logout-btn { background-color: var(--secondary-color); margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Login Section -->
        <div id="login-container" class="login-container">
            <h1>এডমিন লগইন</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">ইমেইল</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">পাসওয়ার্ড</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">লগইন করুন</button>
            </form>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin-panel">
            <h1>এডমিন প্যানেল</h1>
            <form id="post-form">
                <input type="hidden" id="postId">
                <div class="form-group">
                    <label for="title">শিরোনাম</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="category">ক্যাটাগরি</label>
                    <select id="category" required>
                        <option value="সাতক্ষীরা">সাতক্ষীরা</option>
                        <option value="জাতীয়">জাতীয়</option>
                        <option value="খেলাধুলা">খেলাধুলা</option>
                        <option value="রাজনীতি">রাজনীতি</option>
                        <option value="বিনোদন">বিনোদন</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="content">বিস্তারিত</label>
                    <textarea id="content" rows="10" required></textarea>
                </div>
                <div class="form-group">
                    <label for="image">ছবি</label>
                    <input type="file" id="image" accept="image/*">
                </div>
                <button type="submit" id="submit-btn">পোস্ট করুন</button>
            </form>

            <hr style="margin: 30px 0;">

            <h2>সকল পোস্ট</h2>
            <div id="posts-list" class="posts-list"></div>
            
            <button id="logout-btn">লগ আউট</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>

    <script>
        // আপনার ফায়ারবেস কনফিগারেশন এখানে পেস্ট করুন
        const firebaseConfig = {
             apiKey: "AIzaSyA3peBw2W7I80YoCTEpPVCnXelVLUQZMDE",
  authDomain: "satkhira-post.firebaseapp.com",
  projectId: "satkhira-post",
  storageBucket: "satkhira-post.firebasestorage.app",
  messagingSenderId: "236510973672",
  appId: "1:236510973672:web:f83aa94577f1e99ddb435d",
  measurementId: "G-ELJFVZ64YJ"
};
        // Firebase শুরু করুন
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const postForm = document.getElementById('post-form');
        const postsList = document.getElementById('posts-list');
        const logoutBtn = document.getElementById('logout-btn');

        // Check user auth state
        auth.onAuthStateChanged(user => {
            if (user) {
                loginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
                loadPosts();
            } else {
                loginContainer.style.display = 'block';
                adminPanel.style.display = 'none';
            }
        });

        // Login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => alert(error.message));
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // Save or Update Post
        postForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const postId = postForm.postId.value;
            const title = postForm.title.value;
            const category = postForm.category.value;
            const content = postForm.content.value;
            const imageFile = postForm.image.files[0];

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'প্রসেসিং...';

            try {
                let imageUrl = '';
                if (imageFile) {
                    const storageRef = storage.ref(`images/${Date.now()}_${imageFile.name}`);
                    const snapshot = await storageRef.put(imageFile);
                    imageUrl = await snapshot.ref.getDownloadURL();
                }

                const postData = {
                    title,
                    category,
                    content,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if(imageUrl) {
                    postData.imageUrl = imageUrl;
                }

                if (postId) {
                    // Update existing post
                    await db.collection('posts').doc(postId).update(postData);
                    alert('পোস্ট সফলভাবে আপডেট হয়েছে!');
                } else {
                    // Create new post
                    await db.collection('posts').add(postData);
                    alert('পোস্ট সফলভাবে সাবমিট হয়েছে!');
                }
                
                postForm.reset();
                loadPosts();
            } catch (error) {
                console.error("Error saving post: ", error);
                alert('একটি সমস্যা হয়েছে। আবার চেষ্টা করুন।');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'পোস্ট করুন';
            }
        });
        
        // Load all posts in admin panel
        async function loadPosts() {
            const snapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
            postsList.innerHTML = '';
            snapshot.forEach(doc => {
                const post = doc.data();
                const postItem = document.createElement('div');
                postItem.className = 'post-item';
                postItem.innerHTML = `
                    <span>${post.title}</span>
                    <div class="post-item-actions">
                        <button class="btn-edit" onclick="editPost('${doc.id}')">এডিট</button>
                        <button class="btn-delete" onclick="deletePost('${doc.id}')">ডিলিট</button>
                    </div>
                `;
                postsList.appendChild(postItem);
            });
        }
        
        // Edit post
        async function editPost(id) {
            const doc = await db.collection('posts').doc(id).get();
            const post = doc.data();
            postForm.postId.value = id;
            postForm.title.value = post.title;
            postForm.category.value = post.category;
            postForm.content.value = post.content;
            document.getElementById('submit-btn').textContent = 'আপডেট করুন';
            window.scrollTo(0, 0); // Scroll to top to see the form
        }
        
        // Delete post
        async function deletePost(id) {
            if (confirm('আপনি কি এই পোস্টটি ডিলিট করতে নিশ্চিত?')) {
                await db.collection('posts').doc(id).delete();
                alert('পোস্ট ডিলিট করা হয়েছে।');
                loadPosts();
            }
        }

    </script>
</body>
</html>
