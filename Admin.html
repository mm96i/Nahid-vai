<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাডমিন প্যানেল - NewsPortal</title>
    <style>
        :root {
            --primary-color: #2c5282;
            --secondary-color: #2d3748;
            --background-color: #f7fafc;
            --text-color: #2d3748;
            --card-bg: #ffffff;
            --success-color: #38a169;
            --danger-color: #e53e3e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        /* Login Page Styles */
        #login-page {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            color: white;
            background-color: var(--primary-color);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2c5282e0;
        }

        #login-error {
            color: var(--danger-color);
            text-align: center;
            margin-top: 1rem;
            display: none;
        }


        /* Admin Panel Styles */
        #admin-panel {
            display: none; /* Initially hidden */
            width: 100%;
            max-width: 1200px;
            min-height: 90vh;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .admin-wrapper {
            display: flex;
        }

        .sidebar {
            width: 250px;
            background: var(--secondary-color);
            color: white;
            padding: 1rem;
        }
        
        .sidebar h2 {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar ul li a {
            display: block;
            padding: 1rem;
            color: #e2e8f0;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background-color: #4a5568;
        }

        #logout-btn {
            background: var(--danger-color);
            border: none;
            color: white;
            padding: 10px;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 2rem;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .success-btn { background-color: var(--success-color); }
        .danger-btn { background-color: var(--danger-color); }

        /* Table Styles */
        .news-table {
            width: 100%;
            border-collapse: collapse;
        }

        .news-table th, .news-table td {
            padding: 12px;
            border: 1px solid #e2e8f0;
            text-align: left;
        }

        .news-table th {
            background-color: #edf2f7;
        }

        .actions-cell button {
            margin-right: 5px;
            padding: 5px 10px;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Form Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .close-btn {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Login Page -->
    <div id="login-page">
        <div class="login-container">
            <h2>অ্যাডমিন লগইন</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">ইমেল</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">পাসওয়ার্ড</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">লগইন করুন</button>
                <p id="login-error"></p>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <div class="admin-wrapper">
            <aside class="sidebar">
                <h2>NewsPortal</h2>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="dashboard">ড্যাশবোর্ড</a></li>
                    <li><a href="#" class="nav-link" data-page="manage-news">খবর ম্যানেজ</a></li>
                </ul>
                <button id="logout-btn">লগ আউট</button>
            </aside>
            <main class="main-content">
                <!-- Dashboard Page -->
                <div id="dashboard" class="page active">
                    <h1>ড্যাশবোর্ডে স্বাগতম</h1>
                    <p>বাম পাশের মেনু থেকে আপনার কাজ শুরু করুন।</p>
                </div>

                <!-- Manage News Page -->
                <div id="manage-news" class="page">
                    <div class="content-header">
                        <h2>খবরের তালিকা</h2>
                        <button class="primary-btn" id="add-news-btn">নতুন খবর যোগ করুন</button>
                    </div>
                    <table class="news-table">
                        <thead>
                            <tr>
                                <th>শিরোনাম</th>
                                <th>ক্যাটাগরি</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="news-list">
                            <!-- News items will be populated here from Firestore -->
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Add/Edit News Modal -->
    <div id="news-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">নতুন খবর যোগ করুন</h2>
                <span class="close-btn">&times;</span>
            </div>
            <form id="news-form">
                <input type="hidden" id="news-id">
                <div class="form-group">
                    <label for="title">শিরোনাম</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="category">ক্যাটাগরি</label>
                    <select id="category" required>
                        <option value="জাতীয়">জাতীয়</option>
                        <option value="আন্তর্জাতিক">আন্তর্জাতিক</option>
                        <option value="খেলাধুলা">খেলাধুলা</option>
                        <option value="বিনোদন">বিনোদন</option>
                        <option value="টেকনোলজি">টেকনোলজি</option>
                        <option value="লাইফস্টাইল">লাইফস্টাইল</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="excerpt">সংক্ষিপ্ত বিবরণ</label>
                    <textarea id="excerpt" rows="4" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px;"></textarea>
                </div>
                 <div class="form-group">
                    <label for="imageUrl">ছবির URL</label>
                    <input type="text" id="imageUrl" placeholder="https://via.placeholder.com/300x200">
                </div>
                <button type="submit" class="btn">সংরক্ষণ করুন</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // -- START: Firebase Configuration --
        // গুরুত্বপূর্ণ: এই অংশটি আপনার নিজের Firebase প্রজেক্টের কনফিগারেশন দিয়ে পরিবর্তন করুন
        const firebaseConfig = {
            apiKey: "AIzaSyCNQuQuzGSd8PkoqLyKxrZ0QJakSyrS4y0",
            authDomain: "nahidvai80.firebaseapp.com",
            projectId: "nahidvai80",
            storageBucket: "nahidvai80.firebasestorage.app",
            messagingSenderId: "452800032231",
            appId: "1:452800032231:web:7534c2d6f0bb62b8b1e142"
        };
        // -- END: Firebase Configuration --

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const articlesCollection = db.collection('articles');

        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const loginPage = document.getElementById('login-page');
            const adminPanel = document.getElementById('admin-panel');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            const logoutBtn = document.getElementById('logout-btn');
            
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            
            const modal = document.getElementById('news-modal');
            const addNewsBtn = document.getElementById('add-news-btn');
            const closeModalBtn = document.querySelector('.close-btn');
            const newsForm = document.getElementById('news-form');
            const newsList = document.getElementById('news-list');
            const modalTitle = document.getElementById('modal-title');
            const newsIdInput = document.getElementById('news-id');

            // --- Authentication with Firebase ---
            auth.onAuthStateChanged(user => {
                if (user) {
                    loginPage.style.display = 'none';
                    adminPanel.style.display = 'block';
                    renderNews(); // Load news after successful login
                } else {
                    loginPage.style.display = 'block';
                    adminPanel.style.display = 'none';
                }
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                const password = e.target.password.value;
                loginError.style.display = 'none';

                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => {
                        console.error("Login failed:", error);
                        loginError.textContent = 'ভুল ইমেল অথবা পাসওয়ার্ড!';
                        loginError.style.display = 'block';
                    });
            });

            logoutBtn.addEventListener('click', () => {
                auth.signOut();
            });

            // --- Navigation ---
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');
                    const pageId = link.getAttribute('data-page');
                    pages.forEach(page => {
                        page.classList.toggle('active', page.id === pageId);
                    });
                });
            });

            // --- CRUD Operations with Firestore ---
            function renderNews() {
                articlesCollection.orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                    newsList.innerHTML = '';
                    if (snapshot.empty) {
                        newsList.innerHTML = '<tr><td colspan="3" style="text-align:center;">কোনো খবর পাওয়া যায়নি।</td></tr>';
                        return;
                    }
                    snapshot.forEach(doc => {
                        const news = doc.data();
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${news.title}</td>
                            <td>${news.category}</td>
                            <td class="actions-cell">
                                <button class="success-btn" onclick="editNews('${doc.id}')">এডিট</button>
                                <button class="danger-btn" onclick="deleteNews('${doc.id}')">ডিলিট</button>
                            </td>
                        `;
                        newsList.appendChild(row);
                    });
                }, error => {
                    console.error("Error fetching news:", error);
                    newsList.innerHTML = '<tr><td colspan="3" style="text-align:center;">খবর লোড করা যায়নি।</td></tr>';
                });
            }

            window.deleteNews = function(id) {
                if (confirm('আপনি কি এই খবরটি মুছে ফেলতে চান?')) {
                    articlesCollection.doc(id).delete()
                        .then(() => console.log("Document successfully deleted!"))
                        .catch(error => console.error("Error removing document: ", error));
                }
            }
            
            window.editNews = function(id) {
                articlesCollection.doc(id).get().then(doc => {
                    if (doc.exists) {
                        const news = doc.data();
                        modalTitle.textContent = 'খবর এডিট করুন';
                        newsIdInput.value = doc.id;
                        document.getElementById('title').value = news.title;
                        document.getElementById('category').value = news.category;
                        document.getElementById('excerpt').value = news.excerpt;
                        document.getElementById('imageUrl').value = news.imageUrl;
                        modal.style.display = 'flex';
                    } else {
                        console.log("No such document!");
                    }
                }).catch(error => {
                    console.log("Error getting document:", error);
                });
            }

            // --- Modal Handling ---
            addNewsBtn.addEventListener('click', () => {
                modalTitle.textContent = 'নতুন খবর যোগ করুন';
                newsForm.reset();
                newsIdInput.value = '';
                modal.style.display = 'flex';
            });
            
            closeModalBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // --- Form Submission (Create/Update) ---
            newsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = newsIdInput.value;
                const newsData = {
                    title: document.getElementById('title').value,
                    category: document.getElementById('category').value,
                    excerpt: document.getElementById('excerpt').value,
                    imageUrl: document.getElementById('imageUrl').value || 'https://via.placeholder.com/300x200',
                };

                if (id) { // Editing existing news
                    articlesCollection.doc(id).update(newsData)
                        .then(() => console.log("Document successfully updated!"))
                        .catch(error => console.error("Error updating document: ", error));
                } else { // Adding new news
                    newsData.timestamp = firebase.firestore.FieldValue.serverTimestamp();
                    articlesCollection.add(newsData)
                        .then(() => console.log("Document successfully written!"))
                        .catch(error => console.error("Error writing document: ", error));
                }
                
                modal.style.display = 'none';
            });
        });
    </script>
</body>
</html>
